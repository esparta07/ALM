{% extends "base.html" %}
{% load static %}
{% block content %}


<div class="row">
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <!-- Load message -->
    <div id="success-message"></div>
  </div>
</div>
<style>
  #success-message {
    position: fixed;
    bottom: 0;
    right: 20px;
    z-index: 99;
    padding: 10px;
  } 
</style>

<div class="card" style="background-color: #F9E4C8; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);">
  <div class="card-body text-black">
    <div class="card-body">
      <div class="row">
        <div class="col-lg-6">
            <h4><i class="mdi mdi-briefcase">&nbsp;</i>ADD COMPANY</h4>
        </div>
        <div class="col-lg-6 text-right">
          <button class="btn btn-primary ml-1" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
            <i class="mdi mdi-account"></i>&nbsp;ADD OFFICER
          </button>
      </div>
        
    </div>
    <div class="collapse mt-2" id="collapseExample">
      <div class="card card-body"  style="background-color: rgba(255, 255, 255, 0.5);">
        <form method="POST" action="" id="officer-form">
          {% csrf_token %}
          <div class="row">
        
            <div class="col-lg-6">
              <div class="form-group">
                <label for="company"><h5>Company:</h5></label>
                {{ officer_form.company }}
              </div>
    
              <div class="form-group">
                <label for="office"><h5>Office:</h5></label>
                {{ officer_form.office }}
              </div>
    
              <div class="form-group">
                <label for="designation"><h5>Designation:</h5></label>
                {{ officer_form.designation }}
              </div>  
            </div>
            <div class="col-lg-6">
              <div class="form-group">
                <label for="name"><h5>Name:</h5></label>
                {{ officer_form.name }}
              </div>
              <div class="form-group">
                <label for="phone"><h5>Phone:</h5></label>
                {{ officer_form.phone }}
              </div>
              <div class="form-group">
                <label for="email"><h5>Email:</h5></label>
                {{ officer_form.email }}
              </div>
            </div>
          </div>
          <br>
          <button class="btn btn-warning btn-lg waves-effect waves-light" type="submit">Submit</button>
        </form>  
      </div>
    </div>
    

    
    <form method="POST" action="" id="company-form" data-districts-url="{% url 'get_districts' %}" 
    data-municipalities-url="{% url 'get_municipalities' %}" class="mt-4">

      {% csrf_token %}

      <div class="row">
        
        <div class="col-lg-6">
          <div class="form-group">
            <label for="name"><h5>Company Name:</h5></label>
            {{ form.name }}
          </div>

          <div class="form-group">
            <label for="category"><h5>Category:</h5></label>
            {{ form.category }}
          </div>

          <div class="form-group">
            <label for="sub_category"><h5>Sub Category:</h5></label>
            {{ form.sub_category }}
          </div>
          
          <div class="form-group">
            <label for="website"><h5>Website:</h5></label>
            {{ form.website }}
          </div>
          
        </div>
        <div class="col-lg-6">
          <div class="form-group">
            <label for="province"><h5>Province:</h5></label>
            {{ form.province }}
          </div>
          <div class="form-group">
            <label for="district"><h5>District:</h5></label>
            {{ form.district }}
          </div>
          <div class="form-group">
            <label for="municipality"><h5>Municipality:</h5></label>
            {{ form.municipality }}
          </div>
          <div class="form-group">
            <label for="address"><h5>Address:</h5></label>
            {{ form.address }}
          </div>
        </div>
      </div>
      <br>
      <button class="btn btn-warning btn-lg waves-effect waves-light" type="submit">Submit</button>
    </form>
  </div>
  <!-- end card-body-->
</div>
<!-- end card -->

<script>
  $(document).ready(function() {
    // Province change event
    $("#id_province").change(function () {
      const districtUrl = "{% url 'get_districts' %}";
      const provinceId = $(this).val();

      // Fetch districts based on the selected province
      $.ajax({
        url: districtUrl,
        data: {
          'province_id': provinceId
        },
        success: function (data) {
          $("#id_district").html(data);
        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText);
        }
      });
    });

    // District change event
    $("#id_district").change(function () {
      const municipalityUrl = "{% url 'get_municipalities' %}";
      const districtId = $(this).val();

      // Fetch municipalities based on the selected district
      $.ajax({
        url: municipalityUrl,
        data: {
          'district_id': districtId
        },
        success: function (data) {
          $("#id_municipality").html(data);
        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText);
        }
      });
    });

    // Company form submission
    $(document).on('submit', '#company-form', function (e) {
      e.preventDefault();
      $.ajax({
        type: 'POST',
        url: '{% url "add_company" %}',
        data: $(this).serialize(),
        success: function (data) {
          // Update the success message dynamically
          $('#success-message').html('<div class="alert alert-success">Company was added successfully</div>');

          // Reset the form elements
          $('#company-form').trigger('reset');

          // Set a timer to hide the success message after 3 seconds (3000 milliseconds)
          setTimeout(function() {
            $('#success-message').empty(); // Remove the content of the success message
          }, 3000);
        },
        error: function (xhr, textStatus, errorThrown) {
          console.log("Error:", errorThrown);
        }
      });
    });
  });

  // Officer form submission
  $(document).on('submit', '#officer-form', function (e) {
    e.preventDefault();
    $.ajax({
      type: 'POST',
      url: '{% url "submit_officer_form" %}',
      data: $(this).serialize(),
      success: function (data) {
        // Update the success message dynamically
        $('#success-message').html('<div class="alert alert-success">Officer was added successfully</div>');

        // Reset the form elements
        $('#officer-form').trigger('reset');

        // Set a timer to hide the success message after 3 seconds (3000 milliseconds)
        setTimeout(function() {
          $('#success-message').empty(); // Remove the content of the success message
        }, 3000);
      },
      error: function (xhr, textStatus, errorThrown) {
        console.log("Error:", errorThrown);
      }
    });
  });
</script>


{% endblock content %}
